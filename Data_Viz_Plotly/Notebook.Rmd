---
title: "Dataviz mit Plotly PL Data"
output: html_notebook
---

## Fragestellung: "Die Manschafft, die zur Halbzeit vorne liegt, gewinnt mit einer Chance von mindestens 75% auch das Spiel. Falls zur Halbzeit unentschieden ist, gewinnt eher das Heimteam."


Dafür nehmen wir den Datacamp Datensatz [Soccer Data](https://app.datacamp.com/workspace/datasets/dataset-python-soccer)

Als Einführung werden wir auf Datacamp folgende Kurse durchgehen:

- [Interactive Data Visualization with plotly](https://app.datacamp.com/learn/courses/interactive-data-visualization-with-plotly-in-r)

- [Intermediate Interactive Data Visualization with plotly](https://app.datacamp.com/learn/courses/interactive-data-visualization-with-plotly-in-r)

```{r}
# Bibliotheken importieren
library("plotly")
library("plyr")
```

```{r}
# List files in Data folder
files <- list.files(path="./Data/", pattern=NULL, all.files=FALSE, full.names=TRUE)

# Create DataFrame with all csv from 2015-2019
df <- ldply(.data = files, .fun = read.csv)

# View entire DataFrame in R Studio
View(df)

```

```{r}
htr_table <- df %>%
	count(HTR)

ftr_table <- df %>%
	count(FTR)

Results = c("Away", "Draw", "Home")
HT_count <- c(htr_table$n)
FT_count <- c(ftr_table$n)

df_results <- data.frame(Results, HT_count, FT_count)

fig <- plot_ly(
  df_results, x = ~Results, y = ~HT_count, type = 'bar', name = 'Half Time Score') %>% 
  add_trace(y = ~FT_count, name = 'Full Time Score') %>%
  layout(yaxis = list(title = 'Count'), barmode = 'group')

fig

```

```{r}
# HTR & FTR in einer Spalte zusammenfügen

df$result <- paste(df$HTR, df$FTR)

df_count_results <- df %>% 
  group_by(result) %>% 
  summarise(count_result = n() / nrow(df) * 100)

df_count_results %>%
  plot_ly(x = ~reorder(result, count_result), y = ~count_result) %>%
  add_bars() %>%
  layout(xaxis = list(categoryorder = "total descending", title = "Game Progress"),
         yaxis = list(title = "Probability"),
         title = "What is the probability of a game progress?")

```
```{r}
calc_prob <- function(df1, df2) {
  win_prob <- 100 / nrow(df1) * nrow(df2)
}
```

```{r}
df_halftime_home <- df %>% filter(HTR == "H")
df_halftime_away <- df %>% filter(HTR == "A")
df_halftime_draw <- df %>% filter(HTR == "D")

df_fulltime_home_win <- df_halftime_home %>% filter(FTR == "H")
df_fulltime_away_win <- df_halftime_away %>% filter(FTR == "A")
df_fulltime_draw <- df_halftime_draw %>% filter(FTR == "D")

# Heimteam führt zur Halbzeit und gewinnt das Spiel
home_win_prob <- calc_prob(df_halftime_home, df_fulltime_home_win)
print(home_win_prob)
print(nrow(df_fulltime_home_win))

# Auswärtsteam führt zur Halbzeit und gewinnt das Spiel
away_win_prob <- calc_prob(df_halftime_away, df_fulltime_away_win)
print(away_win_prob)
print(nrow(df_fulltime_away_win))

# Unentschieden zur Halbzeit und auch am Ende des Spiels
draw_prob <- calc_prob(df_halftime_draw, df_fulltime_draw)
print(draw_prob)
print(nrow(df_fulltime_draw))

```
```{r}

```

